<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ‰‹æ–ç´€éŒ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --color-pink: #ECD4D4;
            --color-blue: #CCDBE2;
            --color-purple: #C9CBE0;
            --color-gray: #EFEFF1;
            --color-active: #4E6E62; /* ä½¿ç”¨è€…æŒ‡å®šé¡è‰² */
            --text-main: #555555;
        }
        body {
            background-color: var(--color-gray);
            color: var(--text-main);
            font-family: -apple-system, "Microsoft JhengHei", sans-serif;
            font-size: 13px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        /* Tab Styles */
        .nav-tab {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            transition: all 0.2s;
            background-color: var(--color-gray);
            border-bottom: 3px solid transparent;
            font-size: 14px;
            color: #888;
        }
        .nav-tab.active {
            background-color: white;
            color: var(--color-active);
            font-weight: bold;
            border-bottom: 3px solid var(--color-active);
        }
        
        /* Calendar Container */
        .calendar-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #ddd;
        }
        .calendar-cell {
            background-color: white;
            aspect-ratio: 1 / 1;
            padding: 2px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .calendar-cell .date-num {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
        }
        .cell-other { color: #ccc; background-color: #fafafa; }
        .bubble-tea-icon { font-size: 8px; margin: 0; line-height: 1; }
        
        /* Stats Dashboard */
        .stat-box {
            background: white;
            padding: 8px 4px;
            border-radius: 4px;
            text-align: center;
            flex: 1;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .stat-value { font-size: 14px; font-weight: bold; }
        .stat-label { font-size: 11px; color: #888; margin-bottom: 2px; }

        /* Modal & UI Elements */
        .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
        .rating-star { color: #ddd; font-size: 18px; cursor: pointer; }
        .rating-star.active { color: #ffca28; }
        
        input, select, textarea {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 8px;
            width: 100%;
            outline: none;
            background: white;
        }
        .btn-add { background-color: var(--color-blue); color: var(--text-main); }
        .btn-save { background-color: var(--color-active); color: white; }
        
        .scroll-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 40px;
        }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>

    <!-- Top Navigation -->
    <nav class="flex bg-white shadow-sm flex-none">
        <button onclick="switchTab('calendar')" id="tab-calendar" class="nav-tab active">æ—¥æ›†</button>
        <button onclick="switchTab('list')" id="tab-list" class="nav-tab">æ¸…å–®</button>
        <button onclick="switchTab('analysis')" id="tab-analysis" class="nav-tab">åˆ†æ</button>
    </nav>

    <!-- Dashboard: Year Stats -->
    <div class="p-2 flex gap-2 flex-none bg-white border-b">
        <div class="stat-box">
            <div class="stat-label">å¹´åº¦ç¸½æ¯æ•¸</div>
            <div id="y-count" class="stat-value">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">å¹´åº¦ç¸½æ”¯å‡º</div>
            <div id="y-cost" class="stat-value">$0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">å¹³å‡å–®åƒ¹</div>
            <div id="y-avg" class="stat-value">$0</div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col overflow-hidden">
        
        <!-- View: Calendar -->
        <section id="view-calendar" class="scroll-container p-2">
            <div class="calendar-container">
                <div class="flex items-center justify-between mb-2 px-2">
                    <button onclick="moveMonth(-1)" class="p-2 font-bold text-lg">â—€</button>
                    <div id="month-title" class="text-base font-bold text-gray-700">2026å¹´ 1æœˆ</div>
                    <button onclick="moveMonth(1)" class="p-2 font-bold text-lg">â–¶</button>
                </div>

                <div class="flex gap-2 mb-2">
                    <div class="stat-box flex flex-row items-center justify-center gap-2 py-2">
                        <span class="stat-label m-0">æœ¬æœˆæ¯æ•¸:</span>
                        <span id="m-count" class="stat-value">0</span>
                    </div>
                    <div class="stat-box flex flex-row items-center justify-center gap-2 py-2">
                        <span class="stat-label m-0">æœ¬æœˆæ”¯å‡º:</span>
                        <span id="m-cost" class="stat-value">$0</span>
                    </div>
                </div>

                <div class="calendar-grid text-center py-1 text-[11px] font-bold">
                    <div class="bg-[var(--color-blue)]">ä¸€</div>
                    <div class="bg-[var(--color-blue)]">äºŒ</div>
                    <div class="bg-[var(--color-blue)]">ä¸‰</div>
                    <div class="bg-[var(--color-blue)]">å››</div>
                    <div class="bg-[var(--color-blue)]">äº”</div>
                    <div class="bg-[var(--color-pink)]">å…­</div>
                    <div class="bg-[var(--color-pink)]">æ—¥</div>
                </div>
                <div id="calendar-body" class="calendar-grid"></div>
            </div>
        </section>

        <!-- View: List -->
        <section id="view-list" class="hidden scroll-container p-2">
            <div class="sticky top-0 bg-[var(--color-gray)] pb-2 z-10">
                <div class="flex gap-2 mb-2">
                    <input type="text" id="search-input" placeholder="æœå°‹åº—åã€å“é …..." oninput="renderList()">
                    <button onclick="exportList()" class="whitespace-nowrap bg-[var(--color-active)] text-white px-3 rounded text-xs font-bold">åŒ¯å‡ºè¤‡è£½</button>
                </div>

                <div class="bg-white p-3 rounded-lg shadow-sm border border-dashed border-[var(--color-active)]">
                    <h4 class="text-[12px] font-bold mb-2 text-[var(--color-active)] flex items-center gap-1">
                        <span>ğŸ“¥ å¿«é€ŸåŒ¯å…¥/é‚„åŸç´€éŒ„</span>
                    </h4>
                    <textarea id="import-input" class="text-[10px] h-16 mb-2 w-full" placeholder="åœ¨æ­¤è²¼ä¸Šä¹‹å‰å‚™ä»½çš„æ–‡å­—ç´€éŒ„..."></textarea>
                    <button onclick="importFromText()" class="w-full py-1.5 bg-[var(--color-blue)] text-gray-700 rounded text-xs font-bold shadow-sm">è§£æä¸¦å­˜å…¥è³‡æ–™å€</button>
                </div>
            </div>

            <div id="list-container" class="space-y-2 mt-2"></div>
        </section>

        <!-- View: Analysis -->
        <section id="view-analysis" class="hidden scroll-container p-2">
            <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
                <h3 class="text-center font-bold mb-2">åº—å®¶æ¯æ•¸åˆ†ä½ˆ</h3>
                <div class="h-48 flex justify-center">
                    <canvas id="storeChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
                <h3 class="text-center font-bold mb-4 border-b pb-2">å¹´åº¦å“é …æ’è¡Œ (Top 10)</h3>
                <div id="item-rank" class="space-y-2"></div>
            </div>
        </section>
    </main>

    <!-- Entry Modal -->
    <div id="modal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-xl overflow-hidden flex flex-col max-h-[85vh]">
            <div class="p-3 bg-[var(--color-active)] text-white flex justify-between items-center flex-none">
                <span id="modal-date-title" class="font-bold text-sm">2026-01-01</span>
                <button onclick="closeModal()" class="text-2xl px-2">&times;</button>
            </div>
            <div id="drink-forms" class="p-3 overflow-y-auto space-y-4"></div>
            <div class="p-3 border-t bg-gray-50 flex gap-2 flex-none">
                <button onclick="addDrinkEntry()" id="add-btn" class="flex-1 py-2 btn-add rounded-lg font-bold text-xs">ï¼‹ä¸‹ä¸€æ¯</button>
                <button onclick="saveRecords()" class="flex-1 py-2 btn-save rounded-lg font-bold text-xs">å„²å­˜è®Šæ›´</button>
            </div>
        </div>
    </div>

    <!-- Toast Message -->
    <div id="toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿</div>

    <script>
        const ICE_LEVELS = ["ç„¡æ³•èª¿æ•´", "æ­£å¸¸", "å°‘å†°", "å¾®å†°", "å»å†°", "å¸¸æº«", "æº«"];
        const SUGAR_LEVELS = ["ç„¡æ³•èª¿æ•´", "å…¨ç³–", "å°‘ç³–", "åŠç³–", "å¾®ç³–", "ä¸€åˆ†ç³–", "ç„¡ç³–"];
        
        let currentYear = 2026;
        let currentMonth = new Date().getMonth(); 
        let records = JSON.parse(localStorage.getItem('drink_data_2026')) || {};
        let activeDateKey = '';
        let currentDrinks = [];

        window.onload = () => {
            renderCalendar();
            updateStats();
        };

        function switchTab(tab) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            document.getElementById(`view-${tab}`).scrollTop = 0;

            if (tab === 'list') renderList();
            if (tab === 'analysis') renderAnalysis();
            if (tab === 'calendar') renderCalendar();
        }

        function moveMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }

        function renderCalendar() {
            const body = document.getElementById('calendar-body');
            document.getElementById('month-title').innerText = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;
            body.innerHTML = '';

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const padding = firstDay === 0 ? 6 : firstDay - 1;
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();

            for (let i = padding - 1; i >= 0; i--) {
                const cell = document.createElement('div');
                cell.className = 'calendar-cell cell-other';
                cell.innerHTML = `<span class="date-num">${prevMonthDays - i}</span>`;
                body.appendChild(cell);
            }

            for (let d = 1; d <= daysInMonth; d++) {
                const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';
                cell.onclick = () => openModal(dateKey);
                cell.innerHTML = `<span class="date-num">${d}</span>`;

                if (records[dateKey]) {
                    const icons = document.createElement('div');
                    icons.className = 'flex flex-wrap justify-center mt-2 px-1';
                    records[dateKey].forEach(() => {
                        icons.innerHTML += `<span class="bubble-tea-icon">ğŸ§‹</span>`;
                    });
                    cell.appendChild(icons);
                }
                body.appendChild(cell);
            }
            updateStats();
        }

        function openModal(dateKey) {
            activeDateKey = dateKey;
            document.getElementById('modal-date-title').innerText = dateKey;
            currentDrinks = records[dateKey] ? JSON.parse(JSON.stringify(records[dateKey])) : [defaultDrink()];
            renderDrinkForms();
            document.getElementById('modal').classList.remove('hidden');
        }

        function defaultDrink() {
            return { store: '', item: '', ice: 'å»å†°', sugar: 'ä¸€åˆ†ç³–', price: '', rating: 3, note: '' };
        }

        function addDrinkEntry() {
            if (currentDrinks.length < 5) {
                currentDrinks.push(defaultDrink());
                renderDrinkForms();
            }
        }

        function renderDrinkForms() {
            const container = document.getElementById('drink-forms');
            container.innerHTML = '';
            document.getElementById('add-btn').disabled = (currentDrinks.length >= 5);
            document.getElementById('add-btn').style.opacity = (currentDrinks.length >= 5 ? '0.5' : '1');

            currentDrinks.forEach((d, idx) => {
                const div = document.createElement('div');
                div.className = "p-3 bg-[#f9f9f9] border rounded-lg relative shadow-sm";
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-xs text-[var(--color-active)]"># ${idx + 1}</span>
                        ${idx > 0 ? `<button onclick="removeDrink(${idx})" class="text-red-400 text-xs">ç§»é™¤</button>` : ''}
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" placeholder="åº—å" value="${d.store}" oninput="updateCurrent(${idx}, 'store', this.value)">
                        <input type="text" placeholder="å“é …" value="${d.item}" oninput="updateCurrent(${idx}, 'item', this.value)">
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <select onchange="updateCurrent(${idx}, 'ice', this.value)">
                            ${ICE_LEVELS.map(l => `<option ${d.ice === l ? 'selected' : ''}>${l}</option>`).join('')}
                        </select>
                        <select onchange="updateCurrent(${idx}, 'sugar', this.value)">
                            ${SUGAR_LEVELS.map(l => `<option ${d.sugar === l ? 'selected' : ''}>${l}</option>`).join('')}
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="number" placeholder="åƒ¹æ ¼" value="${d.price}" oninput="updateCurrent(${idx}, 'price', this.value)">
                        <div class="flex items-center justify-center gap-1">
                            ${[1, 2, 3, 4, 5].map(s => `<span class="rating-star ${s <= d.rating ? 'active' : ''}" onclick="setRating(${idx}, ${s})">â˜…</span>`).join('')}
                        </div>
                    </div>
                    <textarea class="text-xs h-12" placeholder="å‚™è¨» (åŠ æ–™ã€å¿ƒæƒ…ç­‰)..." oninput="updateCurrent(${idx}, 'note', this.value)">${d.note}</textarea>
                `;
                container.appendChild(div);
            });
        }

        function updateCurrent(idx, field, val) { currentDrinks[idx][field] = val; }
        function setRating(idx, s) { currentDrinks[idx].rating = s; renderDrinkForms(); }
        function removeDrink(idx) { currentDrinks.splice(idx, 1); renderDrinkForms(); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        function saveRecords() {
            const clean = currentDrinks.filter(d => d.store.trim() || d.item.trim());
            if (clean.length > 0) records[activeDateKey] = clean;
            else delete records[activeDateKey];
            
            localStorage.setItem('drink_data_2026', JSON.stringify(records));
            renderCalendar();
            closeModal();
            showToast("ç´€éŒ„å·²æ›´æ–°");
        }

        function updateStats() {
            let yCount = 0, yCost = 0, mCount = 0, mCost = 0;
            const mPrefix = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            
            Object.entries(records).forEach(([date, drinks]) => {
                drinks.forEach(d => {
                    const p = parseFloat(d.price) || 0;
                    if (date.startsWith(currentYear.toString())) { yCount++; yCost += p; }
                    if (date.startsWith(mPrefix)) { mCount++; mCost += p; }
                });
            });

            document.getElementById('y-count').innerText = yCount;
            document.getElementById('y-cost').innerText = `$${yCost}`;
            document.getElementById('y-avg').innerText = `$${yCount ? Math.round(yCost / yCount) : 0}`;
            document.getElementById('m-count').innerText = mCount;
            document.getElementById('m-cost').innerText = `$${mCost}`;
        }

        function renderList() {
            const container = document.getElementById('list-container');
            const q = document.getElementById('search-input').value.toLowerCase();
            container.innerHTML = '';
            
            const flattened = [];
            Object.entries(records).forEach(([date, drinks]) => {
                drinks.forEach(d => flattened.push({...d, date}));
            });
            flattened.sort((a,b) => b.date.localeCompare(a.date));

            const filtered = flattened.filter(i => i.date.includes(q) || i.store.toLowerCase().includes(q) || i.item.toLowerCase().includes(q));

            if (filtered.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-400 py-10">æ‰¾ä¸åˆ°ç›¸é—œç´€éŒ„</div>`;
                return;
            }

            filtered.forEach(i => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "bg-white p-3 rounded-lg border-l-4 border-[var(--color-active)] shadow-sm text-[11px]";
                itemDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-bold text-gray-500 font-mono text-[12px]">${i.date}</span>
                        <span class="font-bold text-[var(--color-active)] text-[13px] font-black">$${i.price || 0}</span>
                    </div>
                    <div class="flex justify-between items-baseline">
                        <span class="font-bold text-[13px] text-gray-700">${i.store} Â· ${i.item}</span>
                        <span class="text-gray-400">${i.ice}/${i.sugar}</span>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-yellow-500 text-[14px]">${'â˜…'.repeat(i.rating)}${'â˜†'.repeat(5-i.rating)}</span>
                        <span class="text-gray-400 italic">${i.note || 'ç„¡å‚™è¨»'}</span>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }

        function exportList() {
            const flattened = [];
            Object.entries(records).forEach(([date, drinks]) => {
                drinks.forEach(d => flattened.push({...d, date}));
            });
            flattened.sort((a,b) => b.date.localeCompare(a.date));

            if (flattened.length === 0) {
                showToast("ç›®å‰æ²’æœ‰ç´€éŒ„å¯åŒ¯å‡º");
                return;
            }

            let text = "ğŸ¥¤ 2026æ‰‹æ–ç´€éŒ„å‚™ä»½ ğŸ¥¤\n\n";
            flattened.forEach((i, idx) => {
                text += `[${idx + 1}] ${i.date}\n`;
                text += `åº—åï¼š${i.store}\n`;
                text += `å“é …ï¼š${i.item}\n`;
                text += `å†°ç³–ï¼š${i.ice} / ${i.sugar}\n`;
                text += `åƒ¹æ ¼ï¼š$${i.price || 0}\n`;
                text += `è©•åˆ†ï¼š${'â˜…'.repeat(i.rating)}\n`;
                if (i.note) text += `å‚™è¨»ï¼š${i.note}\n`;
                text += `------------------------\n`;
            });

            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast("å·²æˆåŠŸè¤‡è£½æ–‡å­—å‚™ä»½");
            } catch (err) {
                showToast("è¤‡è£½å¤±æ•—");
            }
            document.body.removeChild(textArea);
        }

        function importFromText() {
            const input = document.getElementById('import-input').value;
            if (!input.trim()) {
                showToast("è«‹è²¼å…¥å…§å®¹");
                return;
            }

            const blocks = input.split('------------------------');
            let successCount = 0;

            blocks.forEach(block => {
                const lines = block.trim().split('\n');
                if (lines.length < 2) return;

                let date = '', store = '', item = '', ice = 'å»å†°', sugar = 'ä¸€åˆ†ç³–', price = 0, rating = 3, note = '';

                lines.forEach(line => {
                    if (line.includes(']')) {
                        const dateMatch = line.match(/\d{4}-\d{2}-\d{2}/);
                        if (dateMatch) date = dateMatch[0];
                    }
                    if (line.startsWith('åº—åï¼š')) store = line.replace('åº—åï¼š', '').trim();
                    if (line.startsWith('å“é …ï¼š')) item = line.replace('å“é …ï¼š', '').trim();
                    if (line.startsWith('å†°ç³–ï¼š')) {
                        const parts = line.replace('å†°ç³–ï¼š', '').split('/');
                        if (parts.length === 2) {
                            ice = parts[0].trim();
                            sugar = parts[1].trim();
                        }
                    }
                    if (line.startsWith('åƒ¹æ ¼ï¼š')) price = line.replace('åƒ¹æ ¼ï¼š', '').replace('$', '').trim();
                    if (line.startsWith('è©•åˆ†ï¼š')) rating = (line.match(/â˜…/g) || []).length;
                    if (line.startsWith('å‚™è¨»ï¼š')) note = line.replace('å‚™è¨»ï¼š', '').trim();
                });

                if (date && (store || item)) {
                    if (!records[date]) records[date] = [];
                    const exists = records[date].some(r => r.store === store && r.item === item && r.price == price);
                    if (!exists) {
                        records[date].push({ store, item, ice, sugar, price, rating, note });
                        successCount++;
                    }
                }
            });

            if (successCount > 0) {
                localStorage.setItem('drink_data_2026', JSON.stringify(records));
                document.getElementById('import-input').value = '';
                renderList();
                updateStats();
                showToast(`æˆåŠŸåŒ¯å…¥ ${successCount} ç­†æ–°ç´€éŒ„`);
            } else {
                showToast("æœªç™¼ç¾æ–°ç´€éŒ„æˆ–æ ¼å¼ä¸ç¬¦");
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 2000);
        }

        let chartInstance = null;
        function renderAnalysis() {
            const stores = {};
            const statsMap = {}; 

            Object.values(records).flat().forEach(d => {
                if (d.store) stores[d.store] = (stores[d.store] || 0) + 1;
                
                if (d.store && d.item) {
                    const combo = `${d.store} - ${d.item}`;
                    if (!statsMap[combo]) statsMap[combo] = { count: 0, totalPrice: 0 };
                    statsMap[combo].count += 1;
                    statsMap[combo].totalPrice += (parseFloat(d.price) || 0);
                }
            });

            const ctx = document.getElementById('storeChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(stores),
                    datasets: [{
                        data: Object.values(stores),
                        backgroundColor: ['#ECD4D4', '#CCDBE2', '#C9CBE0', '#A5B4FC', '#86efac', '#fde68a', '#94a3b8', '#f87171']
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { 
                            position: 'bottom', 
                            labels: { boxWidth: 10, font: { size: 10 } } 
                        } 
                    } 
                }
            });

            const sortedRank = Object.entries(statsMap)
                .sort((a,b) => b[1].count - a[1].count)
                .slice(0, 10);

            const rankDiv = document.getElementById('item-rank');
            rankDiv.innerHTML = sortedRank.map(([combo, data], idx) => {
                const avgPrice = Math.round(data.totalPrice / data.count);
                return `
                <div class="flex justify-between items-center p-3 bg-[var(--color-gray)] rounded-lg shadow-sm">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-[var(--color-active)] font-bold">TOP ${idx + 1}</span>
                        <span class="text-[13px] font-bold text-gray-700">${combo}</span>
                        <span class="text-[10px] text-gray-400">å¹³å‡åƒ¹æ ¼ï¼š$${avgPrice}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-black text-gray-600">${data.count} <span class="text-[10px] font-normal">æ¯</span></div>
                    </div>
                </div>
            `;
            }).join('') || '<div class="text-center text-gray-400 py-10">å°šç„¡é£²ç”¨æ•¸æ“š</div>';
        }
    </script>
</body>
</html>
